<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MindSkyra Institute ‚Äì Payment</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: linear-gradient(135deg, #000000 0%, #0d104e 100%);
  color: #ffffff;
  min-height: 100vh;
  padding-bottom: 80px;
  overflow-x: hidden;
}

/* Header */
.header {
  background: rgba(0, 0, 0, 0.05);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  padding: 25px 20px;
  border-bottom: 1px solid rgba(0, 0, 0, 0.969);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  position: sticky;
  top: 0;
  z-index: 50;
}

.logo {
  font-size: 24px;
  font-weight: 800;
  text-align: center;
  letter-spacing: 2px;
  text-transform: uppercase;
  background: linear-gradient(45deg, #00d4ff, #99f2c8);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Container */
.container {
  max-width: 500px;
  margin: 0 auto;
  padding: 20px;
}

/* Card */
.card {
  background: linear-gradient(135deg, #2d2d2d 0%, #3a3a3a 100%);
  border: 2px solid #3d3d3d;
  border-radius: 20px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

/* Payment Info */
.payment-amount {
  text-align: center;
  padding: 20px 0;
}

.amount {
  font-size: 48px;
  font-weight: 700;
  color: #00d4ff;
  margin-bottom: 10px;
}

.amount-desc {
  font-size: 14px;
  color: #aaa;
}

/* QR Code */
.qr-section {
  text-align: center;
  padding: 20px 0;
}

.qr-code {
  width: 200px;
  height: 200px;
  margin: 15px auto;
  border-radius: 15px;
  border: 3px solid #00d4ff;
  background: #fff;
  display: block;
}

.qr-instruction {
  font-size: 13px;
  color: #aaa;
  margin-top: 10px;
}

/* UPI Details */
.upi-details {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 12px;
  padding: 15px;
  margin: 15px 0;
}

.upi-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.upi-row:last-child {
  border-bottom: none;
}

.upi-label {
  font-size: 13px;
  color: #aaa;
}

.upi-value {
  font-size: 14px;
  font-weight: 600;
  color: #00d4ff;
}

/* Buttons */
.btn {
  width: 100%;
  padding: 16px;
  border-radius: 12px;
  border: none;
  background: linear-gradient(135deg, #00d4ff 0%, #008bb5 100%);
  color: #000;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-top: 15px;
}

.btn:active {
  transform: scale(0.97);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* File Input */
.file-upload {
  margin: 15px 0;
}

.file-input-wrapper {
  position: relative;
  overflow: hidden;
  display: inline-block;
  width: 100%;
}

.file-input-label {
  display: block;
  padding: 14px;
  background: rgba(0, 212, 255, 0.1);
  border: 2px dashed #00d4ff;
  border-radius: 12px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
}

.file-input-label:active {
  background: rgba(0, 212, 255, 0.2);
}

input[type="file"] {
  position: absolute;
  left: -9999px;
}

.file-name {
  margin-top: 10px;
  font-size: 13px;
  color: #00d4ff;
  text-align: center;
}

.section-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 10px;
  color: #00d4ff;
}

.section-desc {
  font-size: 13px;
  color: #aaa;
  margin-bottom: 15px;
}

/* Message */
.message {
  margin-top: 15px;
  padding: 12px;
  border-radius: 10px;
  text-align: center;
  font-size: 14px;
  display: none;
}

.message.success {
  background: rgba(0, 212, 255, 0.2);
  color: #00d4ff;
  display: block;
}

.message.error {
  background: rgba(255, 82, 82, 0.2);
  color: #ff5252;
  display: block;
}

/* Success Animation */
.success-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.95);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  animation: fadeIn 0.3s ease;
}

.success-overlay.active {
  display: flex;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.success-content {
  text-align: center;
  animation: scaleIn 0.5s ease;
}

@keyframes scaleIn {
  from { transform: scale(0.5); }
  to { transform: scale(1); }
}

.check-icon {
  width: 120px;
  height: 120px;
  background: linear-gradient(135deg, #1f4037 0%, #99f2c8 100%);
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 0 auto 30px;
  animation: bounce 0.6s ease;
}

@keyframes bounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.check-mark {
  font-size: 70px;
  color: #fff;
}

.success-title {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 10px;
  color: #00d4ff;
}

.success-desc {
  font-size: 16px;
  color: #aaa;
}

/* Confetti */
.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  background: #00d4ff;
  position: absolute;
  animation: confetti-fall 3s linear;
}

@keyframes confetti-fall {
  to {
    transform: translateY(100vh) rotate(360deg);
    opacity: 0;
  }
}

/* Bottom Navigation */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(180deg, #174043 0%, #000000 100%);
  display: flex;
  justify-content: space-around;
  padding: 12px 0 20px;
  border-top: 1px solid #000000;
  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
  z-index: 100;
}

.nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  padding: 5px 15px;
  transition: all 0.3s ease;
  color: #888;
}

.nav-item.active {
  color: #00d4ff;
}

.nav-item:active {
  transform: scale(0.9);
}

.nav-icon {
  font-size: 24px;
  margin-bottom: 4px;
}

.nav-label {
  font-size: 11px;
  font-weight: 500;
}
</style>
</head>

<body>

<!-- Header -->
<div class="header">
  <div class="logo">INSTITUTE PAYMENT</div>
</div>

<!-- Main Container -->
<div class="container">

  <!-- Payment Amount Card -->
  <div class="card">
    <div class="payment-amount">
      <div class="amount">‚Çπ749</div>
      <div class="amount-desc">One-time payment ‚Ä¢ All subjects unlocked</div>
    </div>

    <!-- QR Code -->
    <div class="qr-section">
      <img src="qr_code.png" alt="UPI QR Code" class="qr-code">
      <div class="qr-instruction">Scan QR using any UPI app</div>
    </div>

    <!-- UPI Details -->
    <div class="upi-details">
      <div class="upi-row">
        <span class="upi-label">UPI / Phone</span>
        <span class="upi-value">7058623898</span>
      </div>
      <div class="upi-row">
        <span class="upi-label">UPI ID</span>
        <span class="upi-value">vishalprajapati1175@okhdfcbank</span>
      </div>
    </div>

    <!-- Pay Button -->
    <a href="upi://pay?pa=vishalprajapati1175@okhdfcbank&pn=MindSkyra%20Institute&am=749&cu=INR" class="btn">
      Pay ‚Çπ749 via GPay / PhonePe
    </a>
  </div>

  <!-- Upload Proof Card -->
  <div class="card">
    <div class="section-title">Upload Payment Screenshot</div>
    <div class="section-desc">After payment, upload screenshot for approval</div>

    <div class="file-upload">
      <div class="file-input-wrapper">
        <label for="proof" class="file-input-label">
          üì∑ Choose Screenshot
        </label>
        <input type="file" id="proof" accept="image/*">
      </div>
      <div class="file-name" id="fileName"></div>
    </div>

    <button class="btn" id="uploadBtn">Submit Proof</button>

    <div class="message" id="msg"></div>
  </div>

</div>

<!-- Success Overlay -->
<div class="success-overlay" id="successOverlay">
  <div class="success-content">
    <div class="check-icon">
      <div class="check-mark">‚úì</div>
    </div>
    <div class="success-title">Payment Submitted!</div>
    <div class="success-desc">Waiting for approval...</div>
  </div>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
  <div class="nav-item" onclick="go('dashboard.html')">
    <span class="nav-icon">üè†</span>
    <span class="nav-label">Home</span>
  </div>
  <div class="nav-item" onclick="go('subject.html')">
    <span class="nav-icon">üìö</span>
    <span class="nav-label">Subjects</span>
  </div>
  <div class="nav-item active">
    <span class="nav-icon">üí≥</span>
    <span class="nav-label">Payment</span>
  </div>
  <div class="nav-item" onclick="go('dashboard.html')">
    <span class="nav-icon">‚ò∞</span>
    <span class="nav-label">Menu</span>
  </div>
</div>

<script>
function go(p) {
  location.href = p;
}

// File name display
document.getElementById('proof').addEventListener('change', function(e) {
  const fileName = e.target.files[0]?.name || '';
  document.getElementById('fileName').innerText = fileName ? `Selected: ${fileName}` : '';
});

// Confetti effect
function createConfetti() {
  const colors = ['#00d4ff', '#99f2c8', '#1f4037', '#ffffff'];
  for (let i = 0; i < 50; i++) {
    setTimeout(() => {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.animationDelay = Math.random() * 0.5 + 's';
      document.body.appendChild(confetti);
      
      setTimeout(() => confetti.remove(), 3000);
    }, i * 30);
  }
}

function showSuccess() {
  const overlay = document.getElementById('successOverlay');
  overlay.classList.add('active');
  createConfetti();
  
  setTimeout(() => {
    overlay.classList.remove('active');
  }, 3000);
}
</script>

<!-- üî• FIREBASE + UPLOAD LOGIC -->
<script type="module">
import { auth, db } from "./js/firebase.js";
import { onAuthStateChanged } from
  "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { addDoc, collection, serverTimestamp } from
  "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwFsPudPHSmZiVxNxgzas9zbYIMMG5yR4g8DuWJGk9xqxgbvxhJ_9mlI9mRz3PBtcrKHQ/exec";

const uploadBtn = document.getElementById("uploadBtn");
const msg = document.getElementById("msg");

/* AUTH CHECK */
onAuthStateChanged(auth, user => {
  if (!user) location.href = "login.html";
});

/* UPLOAD */
uploadBtn.onclick = async () => {
  const file = document.getElementById("proof").files[0];
  if (!file) {
    msg.className = 'message error';
    msg.innerText = "Please select payment screenshot";
    return;
  }

  uploadBtn.disabled = true;
  uploadBtn.innerText = "Uploading...";
  msg.className = 'message';
  msg.innerText = "";

  const reader = new FileReader();

  reader.onload = async () => {
    try {
      const base64 = reader.result.split(",")[1];

      const res = await fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify({
          fileName: Date.now() + "_" + file.name,
          mimeType: file.type,
          base64: base64
        })
      });

      const data = await res.json();

      if (!data.success) {
        msg.className = 'message error';
        msg.innerText = "Upload failed ‚ùå";
        uploadBtn.disabled = false;
        uploadBtn.innerText = "Submit Proof";
        return;
      }

      await addDoc(collection(db, "payments"), {
        userId: auth.currentUser.uid,
        screenshotUrl: data.fileUrl,
        status: "pending",
        createdAt: serverTimestamp()
      });

      showSuccess();
      uploadBtn.innerText = "Submitted ‚úì";
      msg.className = 'message success';
      msg.innerText = "Screenshot uploaded successfully!";
      msg.innerText = "wait for the approval";
      
    } catch (error) {
      msg.className = 'message error';
      msg.innerText = "Upload failed. Please try again.";
      uploadBtn.disabled = false;
      uploadBtn.innerText = "Submit Proof";
    }
  };

  reader.readAsDataURL(file);
};
</script>

</body>
</html>